<div id="batch_upload_file" class="modal fade" role="dialog">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h3><strong>Batch Upload</strong>...the fastest way to take your products digital!</h3> <button type="button" class="close" data-dismiss="modal">&times;</button> </div>
			<div class="modal-body">
				<p class="text-center">Get your entire product line into your clients hands,<br>wherever they are in the world, when they need it.</p>
				<form id="form-batch_upload_file" method="post" action="<?php echo base_url("profile/batch_upload_file")?>">
					<p class="format-html text-center">Excel files must be formated with the HTML code description for images and the following format:</p>
					<div class="row">
						<div class="col-md-12"><label style="margin-top: 20px;">Step 1) Download the bath upload template</label></div>
						<div class="col-md-12"><p style="margin-bottom: 20px; color:#ec971f">Important: Create unique spreadsheet for each catalog that you are creating or updating</p></div>
						<div class="col-md-12">
							<div class="file-sample table-responsive">
								<table class="table table-bordered">
									<thead>
										<tr>
											<th class="text-center top-number"></th>
											<th class="text-center">A</th>
											<th class="text-center">B</th>
											<th class="text-center">C</th>
											<th class="text-center">D</th>
											<th class="text-center">E</th>
											<th class="text-center">F</th>
											<th class="text-center">G</th>
											<th class="text-center">H</th>
											<th class="text-center">I</th>
											<th class="text-center">J</th>
											<th class="text-center">K</th>
											<th class="text-center">L</th>
											<th class="text-center">M</th>
											<th class="text-center">N</th>
											<th class="text-center">O</th>
											<th class="text-center">P</th>

										</tr>
										<tr>
											<th>
												<p>1</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="image URL">image URL</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Image Title">Image Title</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Image Description">Image Description</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Photographer">Photographer</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Image Type">Image Type</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Service type">Service type</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Service type">Single Unit Price</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Maximum Units at this price">Maximum Units at this price</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Sample pricing does not apply">Sample pricing does not apply</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Usage">Usage</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Style">Style</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Category">Category</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Location">Location</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Keywords">Keywords</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Service Area">Service Area</p>
											</th>
											<th class="bg-blue">
												<p data-toggle="tooltip" data-placement="top" title="Certifications">Certifications</p>
											</th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td>
												<p>2</p>
											</td>
											<td>
												<p>image URL</p>
											</td>
											<td>
												<p>Acme Brass Faucett</p>
											</td>
											<td>
												<p>A traditional design for standard use in any kitchen application</p>
											</td>
											<td>
												<p>Lynn Patel Photography</p>
											</td>
											<td>
												<p>Product</p>
											</td>
											<td>
												<p>Full Custom</p>
											</td>
											<td>
												<p>140</p>
											</td>
											<td>
												<p>10</p>
											</td>
											<td>
												<p></p>
											</td>
											<td>
												<p>Indoor</p>
											</td>
											<td>
												<p>Traditional</p>
											</td>
											<td>
												<p>Kitchen Faucetts</p>
											</td>
											<td>
												<p>Hotel</p>
											</td>
											<td>
												<p>Faucett, hardware, sink, kitchen, hotel, condo, cruiseline</p>
											</td>
											<td>
												<p>Locally</p>
											</td>
											<td>
												<p>UL, CE, CES</p>
											</td>
										</tr>
										<tr>
											<td>
												<p>3</p>
											</td>
											<td>
												<p>image URL</p>
											</td>
											<td>
												<p>Acme Brass Faucett</p>
											</td>
											<td>
												<p>A traditional design for standard use in any kitchen application</p>
											</td>
											<td>
												<p>Lynn Patel Photography</p>
											</td>
											<td>
												<p>Project</p>
											</td>
											<td>
												<p>Full Custom</p>
											</td>
											<td>
												<p></p>
											</td>
											<td>
												<p></p>
											</td>
											<td>
												<p>X</p>
											</td>
											<td>
												<p>Indoor</p>
											</td>
											<td>
												<p>Traditional</p>
											</td>
											<td>
												<p>Kitchen Faucetts</p>
											</td>
											<td>
												<p>Hotel</p>
											</td>
											<td>
												<p>Faucett, hardware, sink, kitchen, hotel, condo, cruiseline</p>
											</td>
											<td>
												<p>Locally</p>
											</td>
											<td>
												<p>UL, CE, CES</p>
											</td>
										</tr>
										<tr>
											<td>
												<p>4</p>
											</td>
											<td>
												<p>image URL</p>
											</td>
											<td>
												<p>Acme Brass Faucett</p>
											</td>
											<td>
												<p>A traditional design for standard use in any kitchen application</p>
											</td>
											<td>
												<p>Lynn Patel Photography</p>
											</td>
											<td>
												<p>Product</p>
											</td>
											<td>
												<p>Full Custom</p>
											</td>
											<td>
												<p>140</p>
											</td>
											<td>
												<p>10</p>
											</td>
											<td>
												<p></p>
											</td>
											<td>
												<p>Indoor</p>
											</td>
											<td>
												<p>Traditional</p>
											</td>
											<td>
												<p>Kitchen Faucetts</p>
											</td>
											<td>
												<p>Hotel</p>
											</td>
											<td>
												<p>Faucett, hardware, sink, kitchen, hotel, condo, cruiseline</p>
											</td>
											<td>
												<p>Locally</p>
											</td>
											<td>
												<p>UL, CE, CES</p>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
							<p class="text-right dowload-excel-sample"><a href="<?php echo base_url("uploads/excel_template/Excel-Template.xlsx")?>" download>Click to download Excel Template</a></p>
						</div>
						<div class="col-md-12"><label style="margin-top: 20px;">Step 2) Choose or Create a Catalog</label></div>
						<div class="col-md-12">
							<div class="box-catalog">
								<div class="box-bg-white catalog-box" id="upload-of-batch">
			                        <div class="row">
			                            <div class="col-md-3">
			                                <p style="float:left;text-align: right;line-height: 1;">Existing Catalogs:<br>
			                                    <span class="text-right" style="font-size:13px; color:#2c9595">Select one only</span>
			                                </p> 
			                            </div>
			                            <div class="col-md-9">
			                                <div class="form-group">
			                                    <ul class="list-inline custom">
				                                    <?php if(@$manufacturers != "" && is_array($manufacturers)):?>
				                                    <?php 
				                                    $i = 0;
				                                    $catalog = $this->input->get("catalog");
				                                    foreach($manufacturers AS $value):?>
				                                        <?php $check = "";
				                                            if(@$catalog == $value["id"]){
				                                                $check = "checked";
				                                            }else{
				                                                if($value["type"] == "0"){
				                                                    $check = "checked";
				                                                }
				                                            }
				                                        ?>
				                                        <li>
				                                            <div class="checkbox check-yelow checkbox-circle">
				                                                <input type="radio" name="manufacturers" id="batch-manufacturers-<?php echo $value["id"]?>" value="<?php echo $value["id"]?>" <?php echo $check;?>>
				                                                <label for="batch-manufacturers-<?php echo $value["id"]?>">
				                                                    <img src="<?php echo base_url($value["logo"]);?>">
				                                                </label>
				                                            </div>
				                                        </li>
				                                    <?php endforeach;?>
				                                    
				                                   <?php endif?>
				                                    </ul>
			                                </div>
			                                <p class="text-right" style="font-size:13px;">To create a new catalog, click here: <span id="ba-add-new-catalog" style="color: #2c9595;text-decoration: none; cursor: pointer;">NEW CATALOG</span></p>
			                            </div>
			                        </div>
			                    </div>
							</div>
						</div>
						<div class="form-group text-right">
						    <div class="col-md-6"></div>
							<div class="col-md-6" id="footer-from"> 
							    <div class="row text-left">
							        <div class="col-md-12"><p style="margin-top: 30px;">Upload status message:<span id="messenger-error"></span></p></div>
							    	<div class="col-md-12">
							    		<a type="button" class="btn btn-gray" data-dismiss="modal">Cancel</a> <button id="upload-from-now" type="button" onclick="$('#batch-upload').trigger('click');return false;" class="btn action-bnt btn-primary relative">Browse Upload Excel file</button> <input type="file" name="batch_upload" id="batch-upload" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" /> 
							    	</div>
							    </div>								
							</div>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<style type="text/css">
	#batch_upload_file .btn {
		font-size: 24px;
		margin-top: 10px;
		padding: 7px 15px;
	}
	
	#batch_upload_file p,
	#batch_upload_file label {
		font-size: 16px;
	}
	
	#lable-upload {
		cursor: pointer;
		position: relative;
		z-index: 99;
	}
	
	.box-upload {
		margin-top: 0;
	}
	
	#batch_upload_file .modal-title {
		font-size: 24px;
		color: #212121;
	}
	
	#batch_upload_file .form-group {
		float: left;
		width: 100%;
	}
	#batch_upload_file #slider-home-page .seach-sumit{right: 10px;}
	#batch_upload_file .modal-dialog {
		max-width: 1000px;
	}
	
	#batch_upload_file .format-html {
		font-size: 16px;
		color: #212121;
		margin-bottom: 30px;
	}
	
	button.close {
		font-size: 30px;
		color: #000;
		opacity: 1;
		position: absolute;
		right: 10px;
		top: 5px;
		z-index: 9;
	}
	
	#batch_upload_file .modal-content {
		border-radius: 0;
	}
	
	#form-batch_upload_file {
		padding-top: 30px;
	}
	
	#batch_upload_file .file-sample {
		margin-bottom: 10px;
	}
	
	#batch_upload_file .file-sample thead th p,
	#batch_upload_file .file-sample tr td p {
		margin-bottom: 0;
		font-size: 12px !important;
		vertical-align: top;
		position: relative;
		color: #203144;
		white-space: nowrap
	}
	
	#batch_upload_file .file-sample thead th {
		font-size: 12px;
		vertical-align: top;
		position: relative;
		color: #203144
	}
	
	.file-sample .table>thead>tr>th {
		vertical-align: top;
	}
	
	#batch_upload_file .table-bordered>thead>tr>th,
	#batch_upload_file .table-bordered>thead>tr>td {
		border-width: 1px !important;
		white-space: nowrap !important;
	}
	
	#batch_upload_file td,
	#batch_upload_file th {
		padding: 5px !important;
	}
	
	.bg-blue {
		background-color: #37a7a7;
		color: #fff !important;
	}
	
	.bg-blue p {
		color: #fff !important;
	}
	
	.bg-blue:after {
		content: "";
		position: absolute;
		right: 0;
		top: 0;
		width: 0px;
		height: 0px;
		border-bottom: 8px solid transparent;
		border-right: 8px solid #e50f0f;
		border-left: 0px solid #e50f0f;
	}
	
	.file-sample {
		-webkit-box-shadow: -5px -4px 11px -1px rgba(0, 0, 0, 0.75);
		-moz-box-shadow: -5px -4px 11px -1px rgba(0, 0, 0, 0.75);
		box-shadow: -5px -4px 11px -1px rgba(0, 0, 0, 0.75);
	}
	
	.top-number:after {
		content: "";
		position: absolute;
		right: 2px;
		bottom: 2px;
		width: 0px;
		height: 0px;
		border-bottom: 0px solid #dedede;
		border-right: 16px solid #dedede;
		border-left: 16px solid transparent;
		border-top: 16px solid transparent;
	}
	
	html body .ui-tooltip.ui-widget.ui-corner-all.ui-widget-content {
		font-size: 16px;
		border: 1px solid #bbbbbb;
		color: #8dc7c7;
	}
	
	html body .ui-tooltip .ui-tooltip-content {
		font-size: 14px;
		color: #8dc7c7;
		text-align: center;
	}
	
	html body .ui-tooltip.ui-widget.ui-corner-all.ui-widget-content:after {
		content: "";
		position: absolute;
		background-image: url("<?php echo skin_url("images/affter-tip.png")?>");
		width: 18px;
		height: 14px;
		background-repeat: no-repeat;
		top: 100%;
		left: 50%;
	}
	
	.dowload-excel-sample a {
		font-size: 14px;
	}
	
	.box-catalog {
		margin-top: 20px;
		float: left;
		width: 100%;
	}
	
	#batch_upload_file #slider-home-page .seach-input-slider {
		font-size: 17px;
		height: 40px;
		border-color: #000;
	}
	
	#batch_upload_file label {
		font-weight: 600;
	}
	
	#batch_upload_file #batch-upload {
		display: none;
		visibility: hidden;
		width: 0;
		height: 0;
		opacity: 0
	}
	
	#list-search-manufacturers {
		position: absolute;
		top: 100%;
		left: 10px;
		right: 0;
		background-color: #fff;
		padding: 0px;
		border: 1px solid #ccc;
		max-height: 190px;
		overflow-y: auto;
		z-index: 999;
		display: none;
	}
	
	#list-search-manufacturers li {
		border-bottom: 1px solid #ccc;
		padding: 5px;
		height: 38px;
		overflow: hidden;
	}
	
	#list-search-manufacturers li img {
		max-height: 100%;
		margin-right: 20px;
	}
	
	#list-search-manufacturers li span {
		color: #000;
	}
	
	.manufacturers-select {
		display: none;
		position: absolute;
		top: 2px;
		right: 60px;
		left: 13px;
		background-color: #fff;
		bottom: 2px;
		z-index: 999;
	}
	
	.manufacturers-select .select-done img {
		overflow: hidden;
		margin-right: 20px;
		height: 33px
	}
	
	.manufacturers-select .select-done {
		max-height: 100%;
		overflow: hidden;
		line-height: 2
	}
	
	.manufacturers-select .remove-select {
		position: absolute;
		color: red;
		right: 0;
		top: 5px;
		cursor: pointer;
		line-height: 0;
	}
	
	#batch_upload_file .box-loadding {
		position: absolute;
		right: 0;
		left: 0;
		text-align: center;
		top: 4px;
	}
	#batch_upload_file input.form-control{position: relative;z-index: 99;}
	#batch_upload_file .box-loadding .loadding {
		width: 40px;
	}
</style>
<script type="text/javascript">
	$('[data-toggle="tooltip"]').tooltip({
		position: {
			my: "left bottom",
			at: "left top-10"
		}
	});
	var X = XLSX;
	var XW = {
		/* worker message */
		msg: 'xlsx',
		/* worker scripts */
		rABS: '<?php echo skin_url() ?>/js/js-xlsx/xlsxworker2.js">',
		norABS: '<?php echo skin_url() ?>/js/js-xlsx/xlsxworker1.js">',
		noxfer: '<?php echo skin_url() ?>/js/js-xlsx/xlsxworker.js">'
	};

	function fixdata(data) {
		var o = "",
			l = 0,
			w = 10240;
		for (; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
		o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
		return o;
	}

	function ab2str(data) {
		var o = "",
			l = 0,
			w = 10240;
		for (; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint16Array(data.slice(l * w, l * w + w)));
		o += String.fromCharCode.apply(null, new Uint16Array(data.slice(l * w)));
		return o;
	}

	function s2ab(s) {
		var b = new ArrayBuffer(s.length * 2),
			v = new Uint16Array(b);
		for (var i = 0; i != s.length; ++i) v[i] = s.charCodeAt(i);
		return [v, b];
	}

	function to_json(workbook) {
		var result = {};
		workbook.SheetNames.forEach(function(sheetName) {
			var roa = X.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
			if (roa.length > 0) {
				result[sheetName] = roa;
			}
		});
		return result;
	}

	function process_wb(wb) {
		var output = "";
		output = JSON.stringify(to_json(wb), 2, 2);
		var check_record = jQuery.parseJSON(output);
		var data_lenght = 0;
		$.each(check_record, function(key, value) {
			data_lenght += $(this).length;
		});
		var catalog = $("#form-batch_upload_file").find("input[type = radio][name = manufacturers]:checked").val();
		if (data_lenght <= 1003) {
			$("#upload-from-now").prop('disabled', true).css("cursor", "wait").append('<div class="box-loadding"><img class="loadding" src = <?php echo base_url("skins/images/loadding.GIF")?>></div>');
			$("#form-batch_upload_file").ajaxSubmit({
				dataType: "json",
				data: {
					"data_file_exl": output
				},
				success: function(data) {
					$("#upload-from-now").find(".box-loadding").remove();
					$("#upload-from-now").prop('disabled', false).css("cursor", "pointer");
					if (data["status"] == "success") {
						$("#form-batch_upload_file #batch-upload").clone().appendTo("#form-batch_upload_file #footer-from");
						$("#form-batch_upload_file #batch-upload").first().remove();
						$("#batch_upload_file #footer-from #messenger-error").text(" Processing batch upload...").css("color","#37a7a7");
						if(typeof catalog !== "undefined")
							$("#upload-batch-success #sent-report").attr("href",base_url + "profile/myphoto?catalog="+catalog);
						setTimeout(function(){
							console.log(catalog);
							$("#batch_upload_file").modal("hide");
							$("#upload-batch-success").modal();
						},4000);
						
					} else {
						$("#upload-from-now").find(".box-loadding").remove();
						$("#upload-from-now").prop('disabled', false).css("cursor", "pointer");
						$("#form-batch_upload_file #batch-upload").clone().appendTo("#form-batch_upload_file #footer-from");
						$("#form-batch_upload_file #batch-upload").first().remove();
						$("#batch_upload_file #footer-from #messenger-error").text(" Error processing upload").css("color","red");
					}
				},
				error: function(error) {
					console.log(error);
					$("#upload-from-now").find(".box-loadding").remove();
					$("#upload-from-now").prop('disabled', false).css("cursor", "pointer");
					$("#form-batch_upload_file #batch-upload").clone().appendTo("#form-batch_upload_file #footer-from");
					$("#form-batch_upload_file #batch-upload").first().remove();
					$("#batch_upload_file #footer-from #messenger-error").text(" Error processing upload").css("color","red");
				}
			});
		} else {
			$("#form-batch_upload_file #batch-upload").clone().appendTo("#form-batch_upload_file #footer-from");
			$("#form-batch_upload_file #batch-upload").first().remove();
			$("#batch_upload_file #footer-from #messenger-error").text(" Total number of records must be less 1000").css("color","red");
		}
		return false;
	}

	function handleFile(e) {
		rABS = 0;
		use_worker = 0;
		var files = e;
		var f = e; {
			var reader = new FileReader();
			var name = f.name;
			reader.onload = function(e) {
				if (typeof console !== 'undefined') console.log("onload", new Date(), rABS, use_worker);
				var data = e.target.result;
				if (use_worker) {
					xw(data, process_wb);
				} else {
					var wb;
					if (rABS) {
						wb = X.read(data, {
							type: 'binary'
						});
					} else {
						var arr = fixdata(data);
						wb = X.read(btoa(arr), {
							type: 'base64'
						});
					}
					process_wb(wb);
				}
			};
			if (rABS) reader.readAsBinaryString(f);
			else reader.readAsArrayBuffer(f);
		}
	}
	$(document).on("change", "#batch-upload", function() {
		var file = $(this)[0].files[0];
		var error = 0;
		if (typeof file.name == "undefined" && file.name == null) {
			error = 1;
			$("#batch_upload_file #form-batch_upload_file #upload-from-now").addClass("warning");
		} else {
			$("#batch_upload_file #form-batch_upload_file #upload-from-now").removeClass("warning");
		}
		if (error == 1) {
			$("#batch-upload").clone().appendTo("#form-batch_upload_file #footer-from");
			$("#batch-upload")[0].remove();
			return false;
		}
		handleFile(file);
	});

	function set_manufacturers(ojb) {
		var id = $(ojb).attr("data-id");
		var url = $(ojb).attr("href");
		var title = $(ojb).attr('data-title');
		$("#batch_upload_file #input-seach").val("");
		$(".manufacturers-select").find("#manufacturers-chose").val(id);
		$(".manufacturers-select").append('<div class="select-done"><img src ="' + url + '">' + title + '<span class="remove-select">x<span></div>');
		$("#list-search-manufacturers").hide();
		$(".manufacturers-select").show();
		return false;
	}
	$(document).on("keyup", "#batch_upload_file #input-seach", function(e) {
		var html_search = "";
		$("#list-search-manufacturers").hide();
		var value = $(this).val();
		if (value != "") {
			$.ajax({
				"url": base_url + 'profile/search_manufacturers',
				"type": "post",
				"dataType": "json",
				"data": {
					"value": value
				},
				success: function(data) {
					if (data["status"] == "success") {
						$.each(data["reponse"], function(key, value) {
							html_search += '<li><a href="' + base_url + value['logo'] + '" data-id="' + value["id"] + '" data-title="' + value["name"] + '" onclick="set_manufacturers(this);return false;"><img src="' + base_url + value['logo'] + '"><span>' + value["name"] + '</sapn></a></li>';
						});
					} else {
						alert("Error");
					}
					$("#list-search-manufacturers").html(html_search);
					if (html_search != "") {
						$("#list-search-manufacturers").show();
					} else {
						$("#list-search-manufacturers").hide();
					}
				},
				error: function() {
					alert("Error");
					$("#list-search-manufacturers").html(html_search);
				}
			});
		} else {
			$("#list-search-manufacturers").html("");
			$("#list-search-manufacturers").hide();
		}
	});
	$(document).on("click", ".manufacturers-select .remove-select", function() {
		$(".select-done").remove();
		$(".manufacturers-select").hide();
		$(".manufacturers-select #manufacturers-chose").val("");
	});
</script>